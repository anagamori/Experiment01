%--------------------------------------------------------------------------
% Author: Akira Nagamori
% Last update: 1/11/2019
% Descriptions: 
%   Analysis test trials
%--------------------------------------------------------------------------

close all
clear all
clc

%--------------------------------------------------------------------------
dataFolder = '/Users/akiranagamori/Documents/GitHub/Experiment01/Record ID 01';
codeFolder = '/Users/akiranagamori/Documents/GitHub/Experiment01';
%--------------------------------------------------------------------------
Fs = 100;

%%
[b,a] = butter(4,0.5/(Fs/2),'high');
[b_low,a_low] = butter(4,20/(Fs/2),'low');
%%
threshold = 0.5;
%%
time = [1:20*Fs]/Fs;
HR_1_all = zeros(10,length(time));
HR_2_all = zeros(10,length(time));
HR_3_all = zeros(10,length(time));

GSR_1_all = zeros(10,length(time));
GSR_2_all = zeros(10,length(time));
GSR_3_all = zeros(10,length(time));

for i = 1:10
    
    fileName1 = ['dc_' num2str(i)];
    fileName2 = ['hg_' num2str(i)];
    fileName3 = ['lg_' num2str(i)];
    %fileName4 = ['compensation_reverse_' num2str(i) '_' num2str(i) '.mat'];
    
    cd (dataFolder)
    load(fileName1);
    cd (codeFolder)   
    Data_HR_1 = data.values_GSR(3*Fs+1:23*Fs,2);
    Data_HR_filt_1 = filtfilt(b,a,Data_HR_1);
    [HR_vec] =  EKG2HR (Data_HR_filt_1,Fs,40);
    HR_1_all(i,:) = HR_vec;
    
    Data_GSR_1 = data.values_GSR(3*Fs+1:23*Fs,3);
    Data_GSR_filt_1 = filtfilt(b_low,a_low,Data_GSR_1);
    GSR_1_all(i,:) = Data_GSR_filt_1;
    
     cd (dataFolder)
    load(fileName2);
    cd (codeFolder)   
    Data_HR_2 = data.values_GSR(3*Fs+1:23*Fs,2);
    Data_HR_filt_2 = filtfilt(b,a,Data_HR_2);
    [HR_vec] =  EKG2HR (Data_HR_filt_2,Fs,40);
    HR_2_all(i,:) = HR_vec;
    
     cd (dataFolder)
    load(fileName3);
    cd (codeFolder)   
    Data_HR_3 = data.values_GSR(3*Fs+1:23*Fs,2);
    Data_HR_filt_3 = filtfilt(b,a,Data_HR_3);
    [HR_vec] =  EKG2HR (Data_HR_filt_3,Fs,40);
    HR_3_all(i,:) = HR_vec;
          
    figure(1)
    ax_1_1 = plot(time,HR_1_all(i,:),'k');
    ax_1_1.Color(4) = 0.5;
    hold on
    ax_2_1 = plot(time,HR_2_all(i,:),'b');
    ax_2_1.Color(4) = 0.5;
    ax_3_1 = plot(time,HR_3_all(i,:),'r');
    ax_3_1.Color(4) = 0.5;
    
    figure(2)
    ax_1_1 = plot(time,GSR_1_all(i,:),'k');
    ax_1_1.Color(4) = 0.5;
    hold on
end

HR_max = max(max(max(HR_1_all)));
if HR_max > 150
    HR_max = 150;
end
HR_min = min(min(min(HR_1_all)));

figure(1)
xlabel('Time (sec)')
ylabel('HR (bpm)')
ylim([HR_min-5 HR_max+5])
hold on
ax_1_2 = plot(time,mean(HR_1_all),'k','LineWidth',2);
ax_2_2 = plot(time,mean(HR_2_all),'b','LineWidth',2);
ax_3_2 = plot(time,mean(HR_3_all),'r','LineWidth',2);
ax_4_2 = plot([5 5],[HR_min-5 HR_max+5],'--','color','m');
legend([ax_1_2(1) ax_2_2(1) ax_3_2(1), ax_4_2(1)], 'Discrete','High gain continuous','Low gain continuous','Go Signal')
hold off

figure(1)
xlabel('Time (sec)')
ylabel('GSR ()')
ylim([HR_min-5 HR_max+5])
hold on
ax_1_2 = plot(time,mean(HR_1_all),'k','LineWidth',2);
